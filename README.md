# mediasoup-easy-one-to-many-server

Backend of an easy to use one-to-many broadcasting tool based on mediasoup.

## Installation

Install all [mediasoup requirements](https://mediasoup.org/documentation/v3/mediasoup/installation/#requirements) first.

Then install this package:

```sh
npm install mediasoup-easy-one-to-many-server
```

## Getting started

You just need to call `createMediasoupRouter` with a `http.Server` to setup the server.

```ts
import express from 'express';
import http from 'http';
import fs from "fs"
import { createMediasoupRouter } from "mediasoup-easy-one-to-many-server"
const app = express();

const server = http.createServer(app);

createMediasoupRouter(server, {
  allowedCorsOrigin: "*",
  listenIps: [
    {
      ip: '0.0.0.0',
      announcedIp: '127.0.0.1',
    },
  ],
  rtcMinPort: 10000,
  rtcMaxPort: 10500,
})

server.listen(3014, () => {
  console.log('listening on *:3014');
});
```

> For production use change `announcedIp: '127.0.0.1'` to `announcedIp: 'your-server's-public-ip'`.

Use `DEBUG=mediasoup:* node ...` to see mediasoup logs.

## API

### createMediasoupRouter(server: http.Server, options: MediasoupRouterOptions)

Creates and starts a mediasoup router for video forwarding. `server` is needed for internal communication with the [producer](https://github.com/sandro-salzmann/mediasoup-easy-one-to-many-consumer-js) and the [consumers](https://github.com/sandro-salzmann/mediasoup-easy-one-to-many-producer-js).

**MediasoupRouterOptions**

| Field & Type                                                                                                                       | Description                                                                                                                                                                                                                         | Required | Default                                      |
| ---------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- | -------------------------------------------- |
| allowedCorsOrigin <br /> *`StaticOrigin \| CustomOrigin`*                                                                          | Allowed cors origins used by the socket.io communication with producer and consumers                                                                                                                                                | No       |                                              |
| logLevel <br /> *[`WorkerLogLevel`](https://mediasoup.org/documentation/v3/mediasoup/api/#WorkerLogLevel)*                           | Logging level for logs generated by the media worker subprocesses (check the [Debugging documentation](https://mediasoup.org/documentation/v3/mediasoup/debugging/)). <br /> Valid values are `'debug'`, `'warn'`, `'error'` and `'none'`. | No       | `'debug'`                                    |
| rtcMinPort <br /> *Number*                                                                                                           | Minimum RTC port for ICE, DTLS, RTP, etc.                                                                                                                                                                                           | No       | 10000                                        |
| rtcMaxPort <br /> *Number*                                                                                                           | Maximum RTC port for ICE, DTLS, RTP, etc.                                                                                                                                                                                           | No       | 10100                                        |
| maxIncomeBitrate <br /> *Number*                                                                                                     | Maximum incoming bitrate in per media stream in `bps`.                                                                                                                                                                              | No       | 3500000                                      |
| initialAvailableOutgoingBitrate <br /> *Number*                                                                                      | Initial available outgoing bitrate (in `bps`).                                                                                                                                                                                      | No       | 1000000                                      |
| listenIps <br /> *`Array<`[`TransportListenIp`](https://mediasoup.org/documentation/v3/mediasoup/api/#TransportListenIp)`\|String>`* | Listening IP address or addresses in order of preference (first one is the preferred one).                                                                                                                                          | No       | `{ ip: '0.0.0.0', announcedIp: '127.0.0.1'}` |

